<link rel="import" href="../uqlibrary-elements/0.5.4/lib/vulcanized.html">

<polymer-element name="uqlibrary-rooms-list" attributes="data">
<template>
  <link rel="stylesheet" href="../uqlibrary-elements/resources/theme/element.css">
  <ul class="three-line-icon-list">
    <li class="gap"></li>
    <core-list id="list" on-core-activate="{{selectRoom}}" data="{{data}}" selection="{{selection}}" fit>
      <template>
          <li class="list-item border">
            <div class="avatar" style="background-image: url('https://app.library.uq.edu.au/assets/images/uq-buildings/{{model.image}}');"></div>
            <div class="content">

              <paper-ripple fit></paper-ripple>

              <div class="line1">
                <uqlibrary-a11y-link data-id="{{model.id}}" on-tap="{{ a11yKeyPressed  }}">
                {{model.title}}
                </uqlibrary-a11y-link>
              </div>

              <div class="line2">
                <span hidden?={{!model.location}}>{{ model.location }}, </span>
                <span hidden?={{!model.building}}>{{ model.building }}, </span>
                <span hidden?={{!model.campus}}>{{ model.campus }}</span>
              </div>
              <div class="line3" hidden?={{!model.next_available_time_text}}>Available time: {{model.next_available_time_text}}</div>
            </div>
          </li>
      </template>
    </core-list>
  </ul>

</template>

<script>
  (function() {
    Polymer('uqlibrary-rooms-list', {

      ready: function() {
      },

      a11yKeyPressed: function(source, event) {
        if (source.path && source.path.length > 0 && source.path[0].attributes["data-id"]) {
          var roomId = source.path[0].attributes["data-id"].value;

          var rooms = this.data.filter(function(room) {
            return room.id === roomId;
          });

          if (rooms && rooms.length == 1) {
            this.selection = rooms[0];
            this.selectRoom();
          }
        }
      },

      setData: function(newData) {
        this.data = newData;
      },

      selectRoom: function(e, data, sender) {
        this.fire('room-selected', {item: this.selection});
      }
    });
  })();
</script>
</polymer-element>
