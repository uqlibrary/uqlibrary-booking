<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../core-animated-pages/core-animated-pages.html">
<link rel="import" href="../core-animated-pages/transitions/slide-from-right.html">
<link rel="import" href="../core-animated-pages/transitions/hero-transition.html">
<link rel="import" href="../core-animated-pages/transitions/cross-fade.html">

<link rel="import" href="../core-drawer-panel/core-drawer-panel.html">
<link rel="import" href="../core-header-panel/core-header-panel.html">
<link rel="import" href="../core-toolbar/core-toolbar.html">
<link rel="import" href="../core-menu/core-menu.html">
<link rel="import" href="../core-icons/core-icons.html">
<link rel="import" href="../core-icons/social-icons.html">
<link rel="import" href="../core-icons/av-icons.html">

<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-fab/paper-fab.html">

<link rel="import" href="../uqlibrary-timeline/uqlibrary-timeline.html">
<link rel="import" href="../uqlibrary-fbs-filter-form/uqlibrary-fbs-filter-form.html">

<polymer-element name="uqlibrary-booking">

  <template>
    <link rel="stylesheet" href="uqlibrary-booking.css">

    <core-drawer-panel id="drawerPanel">

      <core-header-panel drawer id="drawer">
        <core-menu>
          <paper-item label="Dashboard" icon="home"></paper-item>
          <paper-item label="Agenda" icon="schedule"></paper-item>
          <paper-item label="Study" icon="today"></paper-item>
          <paper-item label="Library" icon="social:school"></paper-item>
          <paper-item label="News" icon="av:news"></paper-item>
          <paper-item label="Events" icon="event"></paper-item>
          <paper-item label="Settings" icon="settings"></paper-item>
          <paper-item label="Logout" icon="arrow-forward"></paper-item>
        </core-menu>
      </core-header-panel>

      <core-header-panel main id="main">
        <core-toolbar>
          <paper-icon-button id="toolbar-menu-icon-button" hidden?="{{!pageToolbar.leftButton.icon}}" icon="{{pageToolbar.leftButton.icon ? pageToolbar.leftButton.icon : ''}}" on-tap="{{performLeftToolbarButtonAction}}"></paper-icon-button>
          <span flex id="toolbar-page-title">{{pageToolbar.title}}</span>
          <paper-icon-button id="toolbar-right-icon" on-tap="{{performRightToolbarButtonAction}}" hidden?="{{!pageToolbar.rightButton.icon}}" icon="{{pageToolbar.rightButton.icon ? pageToolbar.rightButton.icon : ''}}"></paper-icon-button>
        </core-toolbar>

        <div id="content">
          <core-animated-pages id="pages"  transitions="hero-transition">
            <section id="myBookings">
                <div class="wrapper">
                  <uqlibrary-timeline events="{{events}}"></uqlibrary-timeline>
                  <paper-fab hero-id="filterForm" hero id="addBookingButton" icon="add" class="action" on-tap="{{showFilterPage}}"></paper-fab>
                </div>
            </section>
            <section id="filterForm">
              <uqlibrary-fbs-filter-form hero-id="filterForm" hero id="fbs-filter-form" formData="{{filterFormData}}"></uqlibrary-fbs-filter-form>
            </section>
          </core-animated-pages>
        </div>
      </core-header-panel>

    </core-drawer-panel>

  </template>

  <script>
    (function() {
      Polymer('uqlibrary-booking', {

        ready: function() {
          this.showMyBookingsPage();
        },

        created: function () {
          var that = this;
          this.events = [
            {
              date: new Date().setHours(0, 0, 0, 0),
              title: "Item title",
              subtitle: "Second line",
              text: "Third line"
            },
            {
              date: new Date().setHours(4, 0, 0, 0),
              title: "Item title",
              subtitle: "Second line",
              text: "Third line"
            },
            {
              date: new Date().setHours(24, 0, 0, 0),
              title: "A long item title A long item title A long item title A long item title A long item title ",
              subtitle: "Second line",
              text: "Third line"
            },
            {
              date: new Date().setHours(25, 0, 0, 0),
              title: "Item title",
              subtitle: "Second line",
              text: "Third line"
            },
            {
              date: new Date().setHours(26, 0, 0, 0),
              title: "Item title",
              subtitle: "Second line",
              text: "Third line"
            },
            {
              date: new Date().setHours(72, 0, 0, 0),
              title: "Item title",
              subtitle: "Second line",
              text: "Third line"
            }
          ];

          this.loadFilterFormData();


          setTimeout(function () {
            that.events.push({
              date: new Date().setHours(2, 0, 0, 0),
              title: "Item title 2",
              subtitle: "Second line",
              text: "Third line"
            });
          }, 2000);

          setTimeout(function () {
            that.events.push({
              date: new Date().setHours(3, 0, 0, 0),
              title: "Item title 3",
              subtitle: "Second line",
              text: "Third line"
            });
          }, 4000);
        },

        togglePanel: function () {
          this.$.drawerPanel.togglePanel();
        },

        selectPage: function(e, t, sender) {

          if(sender.hasAttribute('target-page')) {
            var newPage = sender.attributes.getNamedItem('target-page').value;
            switch(newPage) {
              case 'filterForm':
                this.showFilterPage();
                break;

            }
          }
        },

        showMyBookingsPage: function() {
          this.$.pages.selectedItem = this.$.myBookings;
          this.pageToolbar = {
            leftButton: {icon:'menu', action: 'togglePanel' },
            title: 'My bookings',
            rightButton: {icon:'drawer'},
          };
        },

        showFilterPage: function() {
          this.$.pages.selectedItem = this.$.filterForm;
          this.pageToolbar = {
            leftButton: {icon:'arrow-back', action: 'showMyBookingsPage'},
            title: 'Find a room',
          }
        },
        performLeftToolbarButtonAction: function(e, data, sender) {
          if(this.pageToolbar.leftButton.action) {
            this[this.pageToolbar.leftButton.action](e, data, sender);
          }

        },
        loadFilterFormData: function() {
          this.filterFormData = [];
          this.filterFormData.dates = [];
          var today = new Date();
          for(i = 0; i < 7; i++) {
            this.filterFormData.dates.push({
              date: new Date().setDate(today.getDate() + i)
            });
          }


          this.filterFormData.facilities = [
            {
              title: 'St Lucia',
              id: 'stlucia',
              buildings: [
                {
                  title: 'Biological Sciences Library',
                  id: 'bsl',
                  rooms: [
                    {
                      title: 'Biological Sciences Library Group Room 1',
                      id: 'gr1'

                    },
                    {
                      title: 'Group Room 2',
                      id: 'gr2'

                    },
                    {
                      title: 'Individual Room',
                      id: 'ir'

                    }

                  ]

                },
                {
                  title: 'Duhig Building',
                  id: 'dh',
                  rooms: [
                    {
                      title: 'Group Room 1',
                      id: 'gr1'

                    },
                    {
                      title: 'Projector',
                      id: 'projector'

                    },
                    {
                      title: 'Individual Room',
                      id: 'ir'

                    }

                  ]

                },
                {
                  title: 'Duhig Building 1',
                  id: 'dh1',
                  rooms: [
                    {
                      title: 'Group Room 1',
                      id: 'gr1'

                    },
                    {
                      title: 'Projector',
                      id: 'projector'

                    },
                    {
                      title: 'Individual Room',
                      id: 'ir'

                    }

                  ]

                },
                {
                  title: 'Duhig Building',
                  rooms: [
                    {
                      title: 'Group Room 1',
                      id: 'gr1'

                    },
                    {
                      title: 'Projector',
                      id: 'projector'

                    },
                    {
                      title: 'Individual Room',
                      id: 'ir'

                    }

                  ]

                },
                {
                  title: 'Duhig Building 2',
                  id: 'dh2',
                  rooms: [
                    {
                      title: 'Group Room 1',
                      id: 'gr1'
                    },
                    {
                      title: 'Projector',
                      id: 'projector'

                    },
                    {
                      title: 'Individual Room',
                      id: 'ir'

                    }

                  ]

                },
              ]
            },
            {
              title: 'Gatton',
              id: 'gatton',
              buildings: [
                {
                  title: 'Gatton Biological Sciences Library',
                  id: 'bsl',
                  rooms: [
                    {
                      title: 'Group Room 1',
                      id: 'gr1'

                    },
                    {
                      title: 'Group Room 2',
                      id: 'gr2'

                    },
                    {
                      title: 'Individual Room',
                      id: 'ir'

                    }

                  ]

                },
                {
                  title: 'Gatton Duhig Building',
                  id: 'dh',
                  rooms: [
                    {
                      title: 'Group Room 1',
                      id: 'gr1'

                    },
                    {
                      title: 'Projector',
                      id: 'projector'

                    },
                    {
                      title: 'Individual Room',
                      id: 'ir'

                    }

                  ]

                },
                {
                  title: 'Gatton Duhig Building 1',
                  id: 'dh1',
                  rooms: [
                    {
                      title: 'Group Room 1',
                      id: 'gr1'

                    },
                    {
                      title: 'Projector',
                      id: 'projector'

                    },
                    {
                      title: 'Individual Room',
                      id: 'ir'

                    }

                  ]

                },

              ]
            },

          ];

        }

      });
    })();
  </script>

</polymer-element>
